name: SSH Remote Access Runner

on:
  push:
    branches: [ "main" ]
  # Runs every 4 hours to maintain 24/7 uptime
  schedule:
    - cron: '0 */4 * * *' 
  # Allows you to start it manually from the "Actions" tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 240 # Your requested 4-hour timeout

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Start SSH and Keep Alive
        run: |
          echo "Starting SSH session via sshx.io..."
          
          # 1. Start sshx in the background
          # This command creates a secure link to access the terminal
          curl -sSf https://sshx.io/get | sh -s run &
          
          # Wait 10 seconds for the link to generate
          sleep 10
          
          echo "--------------------------------------------------------"
          echo "Check the logs above/below for the sshx.io URL."
          echo "Click that link to open your SSH terminal."
          echo "--------------------------------------------------------"

          # 2. Keep Alive Loop
          # Runs for 235 minutes (3 hours 55 mins)
          # We stop 5 mins early to avoid a hard crash
          end=$((SECONDS + 235 * 60))
          
          while [ $SECONDS -lt $end ]; do
            echo "SSH Session Active... $(date)"
            # Check-in every 5 minutes so the log stays updated
            sleep 300
          done
          
          echo "Timeout approaching. Shutting down."
